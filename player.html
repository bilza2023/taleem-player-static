<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Taleem Player</title>
  <link rel="stylesheet" href="./src/css/app/app.css" />
  <link rel="stylesheet" href="./dist/taleem-player-app.css" />
  <link rel="stylesheet" href="./src/css/themes/default.css" />
</head>
<body>
  <div id="app"></div><!-- Player mount -->
  <!-- Basic controls (editable UI layer) -->
  <div class="nav-test">
    <button id="play-btn">▶</button>
    <button id="pause-btn">⏸</button>
    <button id="stop-btn">⏹</button>

    <span id="time">0.0s</span>

    <div class="scrub-wrap">
      <input
        id="scrub"
        type="range"
        min="0"
        max="1"
        step="0.1"
      />
    </div>
  </div>
  <script type="module">
    import {
      createTaleemPlayer,
      resolveAssetPaths,
      resolveBackground,
      getDeckEndTime,
      createSilentTimer,
      createAudioTimer,
      startLoop
    } from "./dist/taleem-player-app.js";

    async function init() {
      // -------- Environment config (edit only this section) --------
      const CONTENT_BASE = "/assets";           // "" for Vite public root
      const deckUrl =  `${CONTENT_BASE}/decks/test.json`;
      // --------------------------------------------------------------
      const res = await fetch(deckUrl);
      if (!res.ok) {
        document.body.innerHTML = "<h2>Deck not found</h2>";
        throw new Error("Deck not found");
      }
      const deck = await res.json();

      // Resolve asset paths
      resolveAssetPaths(deck, `${CONTENT_BASE}/images/`);
      resolveBackground(deck, `${CONTENT_BASE}/images/`);

      // Select timer (audio or silent)
      const timer = createAudioTimer(`${CONTENT_BASE}/audio/music.mp3`);
    
      // Create player
      const player = createTaleemPlayer({
        mount: "#app",
        deck
      });

      const duration = getDeckEndTime(deck);
      // Start orchestration
      startLoop({
        player,
        timer,
        duration,
        ui: {
          playBtn: document.getElementById("play-btn"),
          pauseBtn: document.getElementById("pause-btn"),
          stopBtn: document.getElementById("stop-btn"),
          scrub: document.getElementById("scrub"),
          timeEl: document.getElementById("time")
        }
      });
    }
    init();
  </script>
</body>
</html>
